<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
    Lucene Index Structure - Getting Started with Zend_Search_Lucene &ndash; Documentation of ZF1 - Zend Framework
</title>
    <link rel="stylesheet" href="https://froschdesign.github.io/zend-documentation-showcase/css/styles.css">
    <link rel="stylesheet" href="/css/main.css">
</head>
<body id="page-top">
<div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="https://docs.zendframework.com/tutorials/img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<header class="header">
    <div class="container">
        <div class="row">
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation
                    <small class="header__subtitle">ZF1</small>
                </h1>
            </div>
        </div>
    </div>
</header>
<div class="container">
    <div class="row">
        
    
<div class="col-md-9 col-xs-12 content" role="main"><p class="alert alert-warning" role="alert">
    <strong>Caution:</strong> The documentation you are viewing is
    for an older version of Zend Framework.<br>
    You can find the documentation of the current version at:
    <br>
    <a href="https://docs.zendframework.com/">
        https://docs.zendframework.com/    </a>
</p>
            <div id="learning.lucene.index-structure" class="section">
                <div class="info">
                    <h1 class="title">
                        Lucene Index Structure
                    </h1>
                </div>
                <p class="para">
                    In order to fully utilize <span class="classname">Zend_Search_Lucene</span>'s capabilities with maximum performance, you need to understand it's internal index structure.
                </p>
                <p class="para">
                    An <em class="emphasis">index</em> is stored as a set of files within a single directory.
                </p>
                <p class="para">
                    An <em class="emphasis">index</em> consists of any number of independent <em class="emphasis">segments</em> which store information about a subset of indexed documents. Each <em class="emphasis">segment</em> has its own <em class="emphasis">terms dictionary</em>, terms dictionary index, and document storage (stored field values) <a href="#fnid1" name="fn1" id="fn1"><sup>[1]</sup></a><span class="classname">Zend_Search_Lucene</span>. All segment data is stored in <var class="filename">_xxxxx.cfs</var> files, where <em class="emphasis">xxxxx</em> is a segment name.
                </p>
                <p class="para">
                    Once an index segment file is created, it can't be updated. New documents are added to new segments. Deleted documents are only marked as deleted in an optional <var class="filename">&lt;segmentname&gt;.del</var> file.
                </p>
                <p class="para">
                    Document updating is performed as separate delete and add operations, even though it's done using an <span class="methodname">update()</span> <acronym class="acronym">API</acronym> call <a href="#fnid2" name="fn2" id="fn2"><sup>[2]</sup></a><span class="classname">Zend_Search_Lucene</span> <acronym class="acronym">API</acronym>. This simplifies adding new documents, and allows updating concurrently with search operations.
                </p>
                <p class="para">
                    On the other hand, using several segments (one document per segment as a borderline case) increases search time:
                </p>
                <ul class="itemizedlist">
                    <li class="listitem">
                        <p class="para">
                            retrieving a term from a dictionary is performed for each segment;
                        </p>
                    </li>
                    <li class="listitem">
                        <p class="para">
                            the terms dictionary index is pre-loaded for each segment (this process takes the most search time for simple queries, and it also requires additional memory).
                        </p>
                    </li>
                </ul>
                <p class="para">
                    If the terms dictionary reaches a saturation point, then search through one segment is <em class="emphasis">N</em> times faster than search through <em class="emphasis">N</em> segments in most cases.
                </p>
                <p class="para">
                    <em class="emphasis">Index optimization</em> merges two or more segments into a single new one. A new segment is added to the index segments list, and old segments are excluded.
                </p>
                <p class="para">
                    Segment list updates are performed as an atomic operation. This gives the ability of concurrently adding new documents, performing index optimization, and searching through the index.
                </p>
                <p class="para">
                    Index auto-optimization is performed after each new segment generation. It merges sets of the smallest segments into larger segments, and larger segments into even larger segments, if we have enough segments to merge.
                </p>
                <p class="para">
                    Index auto-optimization is controlled by three options:
                </p>
                <ul class="itemizedlist">
                    <li class="listitem">
                        <p class="para">
                            <em class="emphasis">MaxBufferedDocs</em> (the minimal number of documents required before the buffered in-memory documents are written into a new segment);
                        </p>
                    </li>
                    <li class="listitem">
                        <p class="para">
                            <em class="emphasis">MaxMergeDocs</em> (the largest number of documents ever merged by an optimization operation); and
                        </p>
                    </li>
                    <li class="listitem">
                        <p class="para">
                            <em class="emphasis">MergeFactor</em> (which determines how often segment indices are merged by auto-optimization operations).
                        </p>
                    </li>
                </ul>
                <p class="para">
                    If we add one document per script execution, then <em class="emphasis">MaxBufferedDocs</em> is actually not used (only one new segment with only one document is created at the end of script execution, at which time the auto-optimization process starts).
                </p>
                <div class="footnote">
                    <a name="fnid1" href="#fn1" id="fnid1"><sup>[1]</sup></a><span class="para footnote">Starting with Lucene 2.3, document storage files can be shared between segments; however, doesn't use this capability</span>
                </div>
                <div class="footnote">
                    <a name="fnid2" href="#fn2" id="fnid2"><sup>[2]</sup></a><span class="para footnote">This call is provided only by Java Lucene now, but it's planned to extend the with similar functionality</span>
                </div>
            </div>
            <nav>
    <ul class="page-nav hidden-print">
        <li class="page-nav__item"><a rel="prev" class="page-nav__link page-nav__link--prev" href="learning.lucene.intro.html">
                <i class="fa fa-chevron-left"></i> Previous
            </a></li>
        <li class="page-nav__item"><a rel="next" class="page-nav__link page-nav__link--next" href="learning.lucene.index-opening.html">
                Next <i class="fa fa-chevron-right"></i>
            </a></li>
    </ul>
</nav></div>
<div class="col-md-3 col-xs-12 sidebar">
<div class="subnavigation"><div class="component-selector">
<h5 class="component-selector__subtitle">Version 1.12</h5></div><h4 class="subnavigation__title"><a href="learning.lucene.html">Getting Started with Zend_Search_Lucene</a></h4><ul class="subnavigation__list">
                
                
                
                
                <li class="subnavigation__list-item">
                    <a class="subnavigation__link" href="learning.lucene.intro.html">Zend_Search_Lucene Introduction</a>
                </li>
                <li class="subnavigation__list-item subnavigation__list-item--active">
                    <a class="subnavigation__link" href="learning.lucene.index-structure.html">Lucene Index Structure</a>
                </li>
                <li class="subnavigation__list-item">
                    <a class="subnavigation__link" href="learning.lucene.index-opening.html">Index Opening and Creation</a>
                </li>
                <li class="subnavigation__list-item">
                    <a class="subnavigation__link" href="learning.lucene.indexing.html">Indexing</a>
                </li>
                <li class="subnavigation__list-item">
                    <a class="subnavigation__link" href="learning.lucene.searching.html">Searching</a>
                </li>
                <li class="subnavigation__list-item">
                    <a class="subnavigation__link" href="learning.lucene.queries.html">Supported queries</a>
                </li>
                <li class="subnavigation__list-item">
                    <a class="subnavigation__link" href="learning.lucene.pagination.html">Search result pagination</a>
                </li>
            </ul></div></div>

    </div>
</div>
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>© 2006-2019 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.zendframework.com" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://zendframework-slack.herokuapp.com" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://tinyletter.com/mwopzend" class="support__link" title="Newsletter"><i class="fa fa-envelope"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
<script type="text/javascript" src="https://framework.zend.com/js/scripts-9871b49c70.js"></script>
</body>
</html>
